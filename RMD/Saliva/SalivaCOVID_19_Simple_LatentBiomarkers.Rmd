---
title: "Decorrelation-Based Feature Discovery: IR COVID_19"
author: "Jose Tamez"
date: "`r Sys.Date()`"
output:
  html_document: 
    toc: yes
    fig_caption: yes
    number_sections: yes
  word_document: 
    reference_docx: WordStyle_FRESA.docx
    toc: yes
    fig_caption: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(collapse = TRUE, warning = FALSE, message = FALSE,comment = "#>")

```

# Effect of UPSTM-Based Decorrelation on Feature Discovery

Here I showcase of to use BSWiMS feature selection/modeling function coupled with Goal Driven Sparse Transformation Matrix (UPSTM) as a pre-processing step to decorrelate highly correlated features. The aim(s) are:

1.  To improve model performance by uncovering the hidden information between correlated features.

2.  To simplify the interpretation of the machine learning models.

This demo will use:

-   *FRESA.CAD::IDeA()*. For Decorrelation of Multidimensional data sets

    -   *FRESA.CAD::getLatentCoefficients()*. For the extraction of the model of the newly discovered of decorrelated features.


-   *heatmap.2()*. For displaying the correlation matrix



### Loading the libraries

```{r}
library("FRESA.CAD")
library(readxl)
library(igraph)
library(umap)
library(tsne)
library(entropy)

op <- par(no.readonly = TRUE)
pander::panderOptions('digits', 3)
pander::panderOptions('table.split.table', 400)
pander::panderOptions('keep.trailing.zeros',TRUE)

```

## Material and Methods


## Data: The COVID_19 Data-Set

The data to process is described in:

<https://zenodo.org/record/4156647#.Y1bSF3bMKUk>


IR Saliva Testing Dataset


10.5281/zenodo.4156647
<https://doi.org/10.5281/zenodo.4156647>


I added a column to the data identifying the repeated experiments.

```{r}

SalivaIR <- as.data.frame(read_excel("~/GitHub/FCA/Data/SalivaThermal_Source_Data_2.xlsx"))


SalivaIR_set1 <- subset(SalivaIR,RepID==1)
rownames(SalivaIR_set1) <- SalivaIR_set1$ID
SalivaIR_set1$RepID <- NULL
SalivaIR_set1$ID <- NULL
SalivaIR_set1$Ct <- NULL

SalivaIR_set2 <- subset(SalivaIR,RepID==2)
rownames(SalivaIR_set2) <- SalivaIR_set2$ID
SalivaIR_set2$RepID <- NULL
SalivaIR_set2$ID <- NULL
SalivaIR_set2$Ct <- NULL

SalivaIR_set3 <- subset(SalivaIR,RepID==3)
rownames(SalivaIR_set3) <- SalivaIR_set3$ID
SalivaIR_set3$RepID <- NULL
SalivaIR_set3$ID <- NULL
SalivaIR_set3$Ct <- NULL

SalivaIR_Avg <- (SalivaIR_set1 + SalivaIR_set2 + SalivaIR_set3)/3

SalivaIR_d1 <- SalivaIR_Avg[,-1] - SalivaIR_Avg[,c(1:ncol(SalivaIR_Avg)-1)]
SalivaIR_d2 <-  -SalivaIR_d1[,c(1:ncol(SalivaIR_d1)-1)] + SalivaIR_d1[,-1]
colnames(SalivaIR_d2) <- paste("DD",colnames(SalivaIR_d2),sep="_")
colnames(SalivaIR_d1) <- paste("D",colnames(SalivaIR_d1),sep="_")

colnames(SalivaIR_Avg) <- paste("V",colnames(SalivaIR_Avg),sep="_")

SalivaIR_Avg$class <- 1*(str_detect(rownames(SalivaIR_Avg),"P"))
##The fraction of samples in the training set
pander::pander(c(row=nrow(SalivaIR_Avg),col=ncol(SalivaIR_Avg)))

pander::pander(table(SalivaIR_Avg$class))
trainFraction=0.90

SalivaIR_d2$class <- 1*(str_detect(rownames(SalivaIR_d2),"P"))

```


#### Standarize the names for the reporting

```{r results = "asis"}
studyName <- "IRSaliva"
dataframe <- SalivaIR_Avg
outcome <- "class"

TopVariables <- 10

thro <- 0.80
cexheat = 0.15


```

## Generaring the report

```{r parent, child = here::here("~/GitHub/LatentBiomarkers/RMD/Child_univariate/child_Simple_LatentBiomarkers.Rmd")}
```
