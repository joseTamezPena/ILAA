---
title: "Decorrelation-Based Feature Discovery: LGG"
author: "Jose Tamez"
date: "`r Sys.Date()`"
output:
  html_document: 
    toc: yes
    fig_caption: yes
    number_sections: yes
  word_document: 
    reference_docx: WordStyle_FRESA.docx
    toc: yes
    fig_caption: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(collapse = TRUE, warning = FALSE, message = FALSE,comment = "#>")

```

# Effect of UPSTM-Based Decorrelation on Feature Discovery


### Loading the libraries

```{r}
library("FRESA.CAD")
library(readxl)
library(igraph)
library(umap)
library(tsne)
library(entropy)

op <- par(no.readonly = TRUE)
pander::panderOptions('digits', 3)
pander::panderOptions('table.split.table', 400)
pander::panderOptions('keep.trailing.zeros',TRUE)
source("C:/Users/jtame/Documents/GitHub/LatentBiomarkers/RMD/DecorrelationCV.R")

```


## Material and Methods

About Dataset
This dataset is a copy of another Kaggle dataset which can be accessed here:
https://www.kaggle.com/c/glioma-radiomics
The difference is that I have provided ground truth for the test set (test_GT.csv).

The suffix “omics” in Medical Science is associated with analysis of big sets of features (e.g. Genomics, Proteomics). Radiomics are imaging features (e.g., first order and second order) extracted from Regions of Interest (ROI) in radiology images based on predefined functions and filters.
Low grade gliomas (LGG) are a type of brain tumors. Astrocytes and Oligodendrocytes which are two types of brain cells, are considered as origins of LGG. Adult LGG are characterized by different mutations which is important to be correctly identified. With this dataset the goal is to determine if an ROI has 1p19q codeletion (Mutacion=1) or not(Mutacion=0). This plays a key role in predicting patient's response to chemotherapy and their survival.
The dataset provides 640 different radiomics features for each ROI. There are 105 ROIs in the training set and 45 ROIs in the test cohort.

## The Data

https://www.kaggle.com/datasets/knamdar/radiomics-for-lgg-dataset?select=test_GT.csv


```{r}

LGG_Data <- read.csv("~/GitHub/LatentBiomarkers/Data/LGG/train.csv")
LGG_DataTest <- read.csv("~/GitHub/LatentBiomarkers/Data/LGG/test.csv")
LGG_TestGT <- read.csv("~/GitHub/LatentBiomarkers/Data/LGG/test_GT.csv")
LGG_DataTest$Mutacion <- LGG_TestGT$Mutacion

LGG_Data <- rbind(LGG_Data,LGG_DataTest)

rownames(LGG_Data) <- LGG_Data$patientID
LGG_Data$patientID <- NULL

pander::pander(table(LGG_Data$Mutacion))

```

#### Standarize the names for the reporting

```{r results = "asis"}
studyName <- "LGG"
dataframe <- LGG_Data
outcome <- "Mutacion"

needScaling <- TRUE
nLoops <- 100

IDSample <- FALSE
thro <- 0.8
#cmethod="spearman"

```
## CV Analysis and report

```{r parent, child = here::here("~/GitHub/LatentBiomarkers/RMD/Child_univariate/CV_analysis.Rmd")}
```


## Testing different parameters
```{r}

cvData_0.9 <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.9)
cvData_0.8 <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.8)
cvData_0.7 <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.7)
cvData_0.6 <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.6)
cvData_0.5 <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.5)
bpDe <- predictionStats_binary(cvData_0.9$DeMedTestRaw,"IDeA@0.9")
bpDe <- predictionStats_binary(cvData_0.8$DeMedTestRaw,"IDeA@0.8")
bpDe <- predictionStats_binary(cvData_0.7$DeMedTestRaw,"IDeA@0.7")
bpDe <- predictionStats_binary(cvData_0.6$DeMedTestRaw,"IDeA@0.6")
bpDe <- predictionStats_binary(cvData_0.5$DeMedTestRaw,"IDeA@0.5")

cvData_0.9_R <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.9,corRank=FALSE)
cvData_0.8_R <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.8,corRank=FALSE)
cvData_0.7_R <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.7,corRank=FALSE)
cvData_0.6_R <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.6,corRank=FALSE)
cvData_0.5_R <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.5,corRank=FALSE)
bpDe <- predictionStats_binary(cvData_0.9_R$DeMedTestRaw,"IDeA@0.9 CorRank")
bpDe <- predictionStats_binary(cvData_0.8_R$DeMedTestRaw,"IDeA@0.8 CorRank")
bpDe <- predictionStats_binary(cvData_0.7_R$DeMedTestRaw,"IDeA@0.7 CorRank")
bpDe <- predictionStats_binary(cvData_0.6_R$DeMedTestRaw,"IDeA@0.6 CorRank")
bpDe <- predictionStats_binary(cvData_0.5_R$DeMedTestRaw,"IDeA@0.5 CorRank")


cvData_0.9_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.9,Outcome=outcome)
cvData_0.8_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.8,Outcome=outcome)
cvData_0.7_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.7,Outcome=outcome)
cvData_0.6_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.6,Outcome=outcome)
cvData_0.5_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.5,Outcome=outcome)
bpDe <- predictionStats_binary(cvData_0.9_D$DeMedTestRaw,"IDeA@0.9 Driven")
bpDe <- predictionStats_binary(cvData_0.8_D$DeMedTestRaw,"IDeA@0.8 Driven")
bpDe <- predictionStats_binary(cvData_0.7_D$DeMedTestRaw,"IDeA@0.7 Driven")
bpDe <- predictionStats_binary(cvData_0.6_D$DeMedTestRaw,"IDeA@0.6 Driven")
bpDe <- predictionStats_binary(cvData_0.5_D$DeMedTestRaw,"IDeA@0.5 Driven")

cvData_0.9_S <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.9,method="spearman")
cvData_0.8_S <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.8,method="spearman")
cvData_0.7_S <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.7,method="spearman")
cvData_0.6_S <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.6,method="spearman")
cvData_0.5_S <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,DecorPCAEFA=FALSE,thr=0.5,method="spearman")
bpDe <- predictionStats_binary(cvData_0.9_S$DeMedTestRaw,"IDeA@0.9 Spearman")
bpDe <- predictionStats_binary(cvData_0.8_S$DeMedTestRaw,"IDeA@0.8 Spearman")
bpDe <- predictionStats_binary(cvData_0.7_S$DeMedTestRaw,"IDeA@0.7 Spearman")
bpDe <- predictionStats_binary(cvData_0.6_S$DeMedTestRaw,"IDeA@0.6 Spearman")
bpDe <- predictionStats_binary(cvData_0.5_S$DeMedTestRaw,"IDeA@0.5 Spearman")

cvData_0.9_S_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,
                         DecorPCAEFA=FALSE,thr=0.9,Outcome=outcome,method="spearman")
cvData_0.8_S_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,
                         DecorPCAEFA=FALSE,thr=0.8,Outcome=outcome,method="spearman")
cvData_0.7_S_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,
                         DecorPCAEFA=FALSE,thr=0.7,Outcome=outcome,method="spearman")
cvData_0.6_S_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,
                         DecorPCAEFA=FALSE,thr=0.6,Outcome=outcome,method="spearman")
cvData_0.5_S_D <- CV_TDR(dataframe,outcome,loops=nLoops,IDSample=IDSample,scale=FALSE,
                         DecorPCAEFA=FALSE,thr=0.5,Outcome=outcome,method="spearman")
bpDe <- predictionStats_binary(cvData_0.9_S_D$DeMedTestRaw,"IDeA@0.9 Spearman Driven")
bpDe <- predictionStats_binary(cvData_0.8_S_D$DeMedTestRaw,"IDeA@0.8 Spearman Driven")
bpDe <- predictionStats_binary(cvData_0.7_S_D$DeMedTestRaw,"IDeA@0.7 Spearman Driven")
bpDe <- predictionStats_binary(cvData_0.6_S_D$DeMedTestRaw,"IDeA@0.6 Spearman Driven")
bpDe <- predictionStats_binary(cvData_0.5_S_D$DeMedTestRaw,"IDeA@0.5 Spearman Driven")


save.image(paste("ALLCV_analyiss",studyName,".RData",sep="_"))

```

